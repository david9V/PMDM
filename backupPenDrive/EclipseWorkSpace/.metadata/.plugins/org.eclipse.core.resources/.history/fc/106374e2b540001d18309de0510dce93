package ActFichToXML;

import java.io.EOFException;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.RandomAccessFile;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.transform.OutputKeys;
import javax.xml.transform.Result;
import javax.xml.transform.Source;
import javax.xml.transform.Transformer;
import javax.xml.transform.TransformerFactory;
import javax.xml.transform.dom.DOMSource;
import javax.xml.transform.stream.StreamResult;

import org.w3c.dom.DOMImplementation;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Text;

public class Main {

	public static void main(String[] args) {
		try{
			DocumentBuilderFactory factoria = DocumentBuilderFactory.newInstance();
			DocumentBuilder builder = factoria.newDocumentBuilder();
			DOMImplementation implementacion = builder.getDOMImplementation();
			Document documento = implementacion.createDocument(null, "empleados", null);

			RandomAccessFile file = null;
			try {
				file = new RandomAccessFile("archivoAccesoAleatorio.dat", "rw");
			} catch (FileNotFoundException e) {
				System.out.println("Error con el fichero");
				e.printStackTrace();
				System.exit(-1);
			}
			
			String id;
			String apellidos;
			String departamento;
			String salario;
			//Vamos a leer el fichero aleatorioç
			try {
				file.seek(0);
			} catch(EOFException e) {
				System.out.println("Fin de fichero");
			} catch(IOException ex) {
				
			}
			file.seek(0);
			
			
			Source origen = new DOMSource(documento);
			Result resultado = new StreamResult(new File("aleatorio_a_XML.xml"));
			Result consola = new StreamResult(System.out);
			Transformer transformer = TransformerFactory.newInstance().newTransformer();
			transformer.setOutputProperty(OutputKeys.INDENT, "yes");
			transformer.setOutputProperty(OutputKeys.OMIT_XML_DECLARATION, "yes");
			transformer.transform(origen, resultado);
			transformer.transform(origen, consola);
		}catch (Exception e){
			System.out.println("Error: "+ e);
		}
	}
	
	public static Document añadirNodo(Document d, String elemento, String texto) {
		//	creamos el elemento empleado
		Element empleado = d.createElement("empleado");
		//creamos el elemento correo
		Element e = d.createElement(elemento);
		//introducimos la información
		Text t = d. createTextNode(texto);
		//introducimos la versión de xml
		d.setXmlVersion("1.0");
		//añadimos a la raiz al documento el elemento empleado
		d.getDocumentElement().appendChild(empleado);
		//añadimos el elemento correo como elemento hijo de empleado
		empleado.appendChild(e);
		//Se añade el objeto Text email como hijo del objeto Element correo
		e.appendChild(t);
		
		return d;
	}

}
